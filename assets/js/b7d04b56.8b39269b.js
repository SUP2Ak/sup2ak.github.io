"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[299],{1215:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>u,toc:()=>c});var l=t(7462),n=(t(7294),t(3905)),r=(t(4866),t(5162),t(3612));const o={sidebar_position:6},i="server/main.lua",u={unversionedId:"esx_legacy/doublejob/es_extended/server",id:"esx_legacy/doublejob/es_extended/server",title:"server/main.lua",description:"Initiallisez la faction au joueur au joueur qui ce connecte",source:"@site/docs/esx_legacy/doublejob/es_extended/server.md",sourceDirName:"esx_legacy/doublejob/es_extended",slug:"/esx_legacy/doublejob/es_extended/server",permalink:"/https://sup2ak.github.io/docs/esx_legacy/doublejob/es_extended/server",draft:!1,editUrl:"https://github.com/SUP2Ak/sup2ak.github.io/tree/main/docs/esx_legacy/doublejob/es_extended/server.md",tags:[],version:"current",lastUpdatedAt:1675558994,formattedLastUpdatedAt:"Feb 5, 2023",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"esx_legacy",previous:{title:"server/commands.lua",permalink:"/https://sup2ak.github.io/docs/esx_legacy/doublejob/es_extended/command"},next:{title:"client/main.lua",permalink:"/https://sup2ak.github.io/docs/esx_legacy/doublejob/esx_society/client"}},s={},c=[],d={toc:c},p="wrapper";function g(e){let{components:a,...t}=e;return(0,n.kt)(p,(0,l.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"servermainlua"},"server/main.lua"),(0,n.kt)("p",null,"Initiallisez la faction au joueur au joueur qui ce connecte"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Query :")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Au d\xe9but de votre fichier vous avez cette variable :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"local loadPlayer = 'SELECT `accounts`, `job`, `job_grade`, `group`, `position`, `inventory`, `skin`, `loadout`'\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Remplacez l\xe0 par celle-ci :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"local loadPlayer = 'SELECT `accounts`, `job`, `job_grade`, `faction`, `faction_grade`, `group`, `position`, `inventory`, `skin`, `loadout`'\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Les boucles:")),(0,n.kt)(r.Z,{type:"tip",icon:"\ud83d\udca1",title:"Savez vous que ...",mdxType:"Admonition"},(0,n.kt)("p",null," Vous pouvez chercher toute les boucles dans votre editeur de texte via ",(0,n.kt)("code",null,"ctrl+f")," copi\xe9 : ",(0,n.kt)("code",null,"while not next(ESX.Jobs) do")," et remplacer par ceci : ",(0,n.kt)("code",null,"while not next(ESX.Jobs) and not next(ESX.Factions) do")," ")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Cherchez dans le fichier toute les boucles ci-dessous :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"while not next(ESX.Jobs) do\n    Wait(50)\nend\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Et remplacez les par ceci :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"while not next(ESX.Jobs) and not next(ESX.Factions) do\n    Wait(50)\nend\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Dans la function ",(0,n.kt)("code",null,"function loadESXPlayer(identifier, playerId, isNew)"))),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Table userData")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Remplacez la variable")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"local userData = {accounts = {}, inventory = {}, job = {}, loadout = {}, playerName = GetPlayerName(playerId), weight = 0}\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Par celle ci :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"local userData = {accounts = {}, inventory = {}, job = {}, faction = {}, loadout = {}, playerName = GetPlayerName(playerId), weight = 0}\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Variable (faction, gradef, factionObject, gradefObject)")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"En dessous de :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"local job, grade, jobObject, gradeObject = result.job, tostring(result.job_grade)\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Ajoutez ceci :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"local faction, gradef, factionObject, gradefObject = result.faction, tostring(result.faction_grade)\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Charger la faction object pour le player object")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Au dessus de :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"-- Job\nif ESX.DoesJobExist(job, grade) then\n    jobObject, gradeObject = ESX.Jobs[job], ESX.Jobs[job].grades[grade]\nelse\n    print(('[^3WARNING^7] Ignoring invalid job for ^5%s^7 [job: ^5%s^7, grade: ^5%s^7]'):format(identifier, job, grade))\n    job, grade = 'unemployed', '0'\n    jobObject, gradeObject = ESX.Jobs[job], ESX.Jobs[job].grades[grade]\nend\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Ajoutez ceci :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"--Faction\nif ESX.DoesFactionExist(faction, gradef) then\n    factionObject, gradefObject = ESX.Factions[faction], ESX.Factions[faction].grades[gradef]\nelse\n    print(('[^3WARNING^7] Ignoring invalid faction for %s [faction: %s, grade: %s]'):format(identifier, faction, gradef))\n    faction, gradef = 'nofaction', '0'\n    factionObject, gradefObject = ESX.Factions[faction], ESX.Factions[faction].grades[gradef]\nend\n\nuserData.faction.id = factionObject.id\nuserData.faction.name = factionObject.name\nuserData.faction.label = factionObject.label\n\nuserData.faction.grade = tonumber(gradef)\nuserData.faction.grade_name = gradefObject.name\nuserData.faction.grade_label = gradefObject.label\nuserData.faction.grade_salary = gradefObject.salary\n\nuserData.faction.skin_male = {}\nuserData.faction.skin_female = {}\n\nif gradefObject.skin_male then\n    userData.faction.skin_male = json.decode(gradefObject.skin_male)\nend\nif gradefObject.skin_female then\n    userData.faction.skin_female = json.decode(gradefObject.skin_female)\nend\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Ajoutez l'object faction sur la cr\xe9ation du player objet")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Trouvez cette variable :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"local xPlayer = CreateExtendedPlayer(playerId, identifier, userData.group, userData.accounts, userData.inventory, userData.weight, userData.job, userData.loadout, userData.playerName, userData.coords)\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Puis remplacez l\xe0 par celle-ci :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"local xPlayer = CreateExtendedPlayer(playerId, identifier, userData.group, userData.accounts, userData.inventory, userData.weight, userData.job, userData.faction, userData.loadout, userData.playerName, userData.coords)\n"))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Envoyez le player objet au client (ESX.PlayerData)")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Trouvez la function ci-dessous :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'xPlayer.triggerEvent(\'esx:playerLoaded\',\n{\n    accounts = xPlayer.getAccounts(),\n    coords = xPlayer.getCoords(),\n    identifier = xPlayer.getIdentifier(),\n    inventory = xPlayer.getInventory(),\n    job = xPlayer.getJob(),\n    loadout = xPlayer.getLoadout(),\n    maxWeight = xPlayer.getMaxWeight(),\n    money = xPlayer.getMoney(),\n    sex = xPlayer.get("sex") or "m",\n    firstName = xPlayer.get("firstName") or "John",\n    lastName = xPlayer.get("lastName") or "Doe",\n    dateofbirth = xPlayer.get("dateofbirth") or "01/01/2000",\n    height = xPlayer.get("height") or 120,\n    dead = false\n}, isNew, userData.skin)\n'))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Remplacez l\xe0 par celle-ci :")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'xPlayer.triggerEvent(\'esx:playerLoaded\',\n{\n    accounts = xPlayer.getAccounts(),\n    coords = xPlayer.getCoords(),\n    identifier = xPlayer.getIdentifier(),\n    inventory = xPlayer.getInventory(),\n    job = xPlayer.getJob(),\n    faction = xPlayer.getFaction(),\n    loadout = xPlayer.getLoadout(),\n    maxWeight = xPlayer.getMaxWeight(),\n    money = xPlayer.getMoney(),\n    sex = xPlayer.get("sex") or "m",\n    firstName = xPlayer.get("firstName") or "John",\n    lastName = xPlayer.get("lastName") or "Doe",\n    dateofbirth = xPlayer.get("dateofbirth") or "01/01/2000",\n    height = xPlayer.get("height") or 120,\n    dead = false\n}, isNew, userData.skin)\n'))))))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Vous pouvez modifier la function callback par d\xe9faut")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Cherchez la fonction ",(0,n.kt)("code",null,"ESX.RegisterServerCallback('esx:getOtherPlayerData', function(source, cb, target)")," et Remplacez l\xe0 par celle-ci")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"ESX.RegisterServerCallback('esx:getOtherPlayerData', function(source, cb, target)\nlocal xPlayer = ESX.GetPlayerFromId(target)\n\ncb({identifier = xPlayer.identifier, accounts = xPlayer.getAccounts(), inventory = xPlayer.getInventory(), job = xPlayer.getJob(), faction = xPlayer.getFaction(), loadout = xPlayer.getLoadout(), money =xPlayer.getMoney(), position = xPlayer.getCoords(true)})\nend)\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",null,(0,n.kt)("u",null,"Cherchez la fonction ",(0,n.kt)("code",null,"ESX.RegisterServerCallback('esx:getPlayerData', function(source, cb)")," et Remplacez l\xe0 par celle-ci")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"ESX.RegisterServerCallback('esx:getPlayerData', function(source, cb)\nlocal xPlayer = ESX.GetPlayerFromId(target)\n\ncb({identifier = xPlayer.identifier, accounts = xPlayer.getAccounts(), inventory = xPlayer.getInventory(), job = xPlayer.getJob(), faction = xPlayer.getFaction(), loadout = xPlayer.getLoadout(), money =xPlayer.getMoney(), position = xPlayer.getCoords(true)})\nend)\n")))))))}g.isMDXComponent=!0}}]);